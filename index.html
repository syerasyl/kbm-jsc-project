<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=relative, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
  <title>KBM Corporate Website</title>
</head>
<body>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-org-chart@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-flextree@2.1.2/build/d3-flextree.js"></script>
    <script src="app.js"></script>

    <div class="wrapper">
      <div class="sidebar">
          <h2>ОргСтруктура</h2>
          <ul>
              <li><a href="#">12345</a></li>
              <li><a href="#">12345</a></li>
              <li><a href="#">12345</a></li>
              <li><a href="#">12345</a></li>
              <li><a href="#">12345</a></li>
              <li><a href="#">12345</a></li>
              <li><a href="#">12345</a></li>
          </ul> 
      </div>
    </div>

    <div class="chart-container" style="height:100%; width:auto;background-color:#e9ecef; padding-left:0px;padding-right:0px;padding-top:0px;padding-bottom:10px;">
          <script>
            var chart;
            d3.csv(
              'https://raw.githubusercontent.com/syerasyl/kbm-jsc-project/main/123.csv'
            ).then((dataFlattened) => {
              chart = new d3.OrgChart()
                .container('.chart-container')
                .data(dataFlattened)
                .nodeWidth((d) => 250)
                .initialZoom(0.7)
                .nodeHeight((d) => 175)
                .childrenMargin((d) => 40)
                .compactMarginBetween((d) => 15)
                .compactMarginPair((d) => 80)
                .nodeContent(function (d, i, arr, state) {
                  return `
                  <div style="padding-top:30px;background-color:none;margin-left:1px;height:${d.height}px;border-radius:2px;overflow:visible">
                        <div style="height:${d.height - 37}px;padding-top:0px;background-color: #f8f9fa;border:0.2em solid lightgrey;">
                              
                              <img src=" ${d.data.imageUrl}" style="margin-top:4px;margin-left:${d.width - d.width + 3}px;border:1px solid lightgrey;width:60px;height:70px;">

                              <div class="top-right">
                                  <div style="color:#111672;font-size:11px;font-weight:bold">
                                    ${d.data.positionName}
                                  </div>
                                  <div style="color:#404040;font-size:10px;font-weight:bold;margin-top:3px">
                                    ${d.data.name}
                                  </div>
                              </div>

                              <div class="top-right-2">
                                Кабинет №  ${d.data.office}
                              </div>

                              <div class="top-right-3"> 
                                <a href="mailto:${d.data.email}">${d.data.email}</a>
                              </div>

                              <div class="top-right-4"> 
                                Вн. номер: ${d.data.phoneNum} 
                              </div>

                              <div class="top-right-5"> 
                                Мобильный: ${d.data.cellPhoneNum}
                              </div>

                              <div style="display:flex;justify-content:space-between;padding-top:43px;padding-left:10px;padding-right:15px;">
                                  <div> 
                                    Заместители:  ${d.data._directSubordinates}
                                  </div>  
                                  <div > 
                                    Сотрудники: ${d.data._totalSubordinates}
                                  </div>   
                              </div>

                        </div>     
                  </div>

                  `;
                })
                .render();
            });
          </script>
    </div>

    </body>
</html>